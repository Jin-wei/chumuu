!function(e){e.fn.extend({autocomplete:function(t,n){var a="string"==typeof t;return n=e.extend({},e.Autocompleter.defaults,{url:a?t:null,urls:n.urls,data:a?null:t,delay:a?e.Autocompleter.defaults.delay:10,max:n&&!n.scroll?10:150,selectCallback:n.selectCallback,noRecord:"No Records."},n),n.highlight=n.highlight||function(e){return e},n.formatMatch=n.formatMatch||n.formatItem,this.each(function(){new e.Autocompleter(this,n)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,n){function a(){var e=E.selected();if(!e)return!1;var t=e.result;return w=t,b.val(t),n.selectCallback(),u(),b.trigger("result",[e.data,e.value]),!0}function i(e,t){if(g!=m.DEL){var a=b.val();(t||a!=w)&&(w=a,(a=o(a)).length>=n.minChars?(b.addClass(n.loadingClass),n.matchCase||(a=a.toLowerCase()),f(a,c,u)):(d(),E.hide()))}else E.hide()}function r(t){return t?n.multiple?e.map(t.split(n.multipleSeparator),function(n){return e.trim(t).length?e.trim(n):null}):[e.trim(t)]:[""]}function o(a){if(!n.multiple)return a;var i=r(a);if(1==i.length)return i[0];var o=e(t).selection().start;return(i=r(o==a.length?a:a.replace(a.substring(o),"")))[i.length-1]}function l(a,i){n.autoFill&&o(b.val()).toLowerCase()==a.toLowerCase()&&g!=m.BACKSPACE&&(b.val(b.val()+i.substring(o(w).length)),e(t).selection(w.length,w.length+i.length))}function s(){clearTimeout(v),v=setTimeout(u,200)}function u(){E.visible();E.hide(),clearTimeout(v),d(),n.mustMatch&&b.search(function(e){if(!e)if(n.multiple){var t=r(b.val()).slice(0,-1);b.val(t.join(n.multipleSeparator)+(t.length?n.multipleSeparator:""))}else b.val(""),b.trigger("result",null)})}function c(e,t){t&&t.length&&T?(d(),E.display(t,e),l(e,t[0].value),E.show()):u()}function f(a,i,r){n.matchCase||(a=a.toLowerCase());var l=A.load(a);if(l)if(l.length)i(a,l);else{var s=n.parse;i(a,s)}else if(n.urls.length>0){var u={timestamp:+new Date};e.each(n.extraParams,function(e,t){u[e]="function"==typeof t?t():t});var c=[];for(var f in n.urls)c.push(function(i){var r=new promise.Promise;return e.ajax({mode:"abort",port:"autocomplete"+t.name,dataType:n.dataType,url:i,data:e.extend({name:b.val(),q:o(a),limit:n.max},u),success:function(e){r.done(e)}}),r}(n.urls[f]));promise.join(c).then(function(e){console.log("done",e);var t=[],r=null;(r=e[0][0])&&r.length>0&&(t[t.length]={data:"[Restaurants]",value:"",result:""},t=t.concat(n.parse&&n.parse(r)||h(r))),(r=e[1][0])&&r.length>0&&(t[t.length]={data:"[Dishes]",value:"",result:""},t=t.concat(n.parse&&n.parse(r)||h(r))),i(a,t)})}else E.emptyList(),null!=p?p():r(a)}function h(t){var a=[],i=null;i="string"==typeof t?t.split("\n"):t;for(var r=0;r<i.length;r++){var o=e.trim(i[r]);o&&(o=o.split("|"),a[a.length]={data:o,value:o[0],result:n.formatResult&&n.formatResult(o,o[0])||o[0]})}return a}function d(){b.removeClass(n.loadingClass)}var m={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},p=null;null!=n.failure&&"function"==typeof n.failure&&(p=n.failure);var v,g,C,b=e(t).attr("autocomplete","off").addClass(n.inputClass),w="",A=e.Autocompleter.Cache(n),T=0,x={mouseDownOnSelect:!1},E=e.Autocompleter.Select(n,t,a,x);-1!=navigator.userAgent.indexOf("Opera")&&e(t.form).bind("submit.autocomplete",function(){if(C)return C=!1,!1}),b.bind((-1!=navigator.userAgent.indexOf("Opera")&&!1 in window?"keypress":"keydown")+".autocomplete",function(t){switch(T=1,g=t.keyCode,t.keyCode){case m.UP:E.visible()?(t.preventDefault(),E.prev()):i(0,!0);break;case m.DOWN:E.visible()?(t.preventDefault(),E.next()):i(0,!0);break;case m.PAGEUP:E.visible()?(t.preventDefault(),E.pageUp()):i(0,!0);break;case m.PAGEDOWN:E.visible()?(t.preventDefault(),E.pageDown()):i(0,!0);break;case n.multiple&&","==e.trim(n.multipleSeparator)&&m.COMMA:case m.TAB:case m.RETURN:if(a())return t.preventDefault(),C=!0,!1;break;case m.ESC:E.hide();break;default:clearTimeout(v),v=setTimeout(i,n.delay)}}).focus(function(){T++}).blur(function(){T=0,x.mouseDownOnSelect||s()}).click(function(){n.clickFire?E.visible()||i(0,!0):T++>1&&!E.visible()&&i(0,!0)}).bind("search",function(){function t(e,t){var a;if(t&&t.length)for(var i=0;i<t.length;i++)if(t[i].result.toLowerCase()==e.toLowerCase()){a=t[i];break}"function"==typeof n?n(a):b.trigger("result",a&&[a.data,a.value])}var n=arguments.length>1?arguments[1]:null;e.each(r(b.val()),function(e,n){f(n,t,t)})}).bind("flushCache",function(){A.flush()}).bind("setOptions",function(){e.extend(!0,n,arguments[1]),"data"in arguments[1]&&A.populate()}).bind("unautocomplete",function(){E.unbind(),b.unbind(),e(t.form).unbind(".autocomplete")})},e.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:100,max:1e3,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:" ",inputFocus:!0,clickFire:!1,highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180,scrollJumpPosition:!0},e.Autocompleter.Cache=function(t){function n(e,n){t.matchCase||(e=e.toLowerCase());var a=e.indexOf(n);return"word"==t.matchContains&&(a=e.toLowerCase().search("\\b"+n.toLowerCase())),-1!=a&&(0==a||t.matchContains)}function a(e,n){l>t.cacheLength&&r(),o[e]||l++,o[e]=n}function i(){if(!t.data)return!1;var n={},i=0;t.url||(t.cacheLength=1),n[""]=[];for(var r=0,o=t.data.length;r<o;r++){var l=t.data[r];l="string"==typeof l?[l]:l;var s=t.formatMatch(l,r+1,t.data.length);if(void 0!==s&&!1!==s){var u=s.charAt(0).toLowerCase();n[u]||(n[u]=[]);var c={value:s,data:l,result:t.formatResult&&t.formatResult(l)||s};n[u].push(c),i++<t.max&&n[""].push(c)}}e.each(n,function(e,n){t.cacheLength++,a(e,n)})}function r(){o={},l=0}var o={},l=0;return setTimeout(i,25),{flush:r,add:a,populate:i,load:function(a){if(!t.cacheLength||!l)return null;if(!t.url&&t.matchContains){u=[];for(var i in o)if(i.length>0){var r=o[i];e.each(r,function(e,t){n(t.value,a)&&u.push(t)})}return u}if(o[a])return o[a];if(t.matchSubset)for(var s=a.length-1;s>=t.minChars;s--)if(r=o[a.substr(0,s)]){var u=[];return e.each(r,function(e,t){n(t.value,a)&&(u[u.length]=t)}),u}return null}}},e.Autocompleter.Select=function(t,n,a,i){function r(){C&&(d=e("<div/>").hide().addClass(t.resultsClass).css("position","absolute").appendTo(document.body).hover(function(t){e(this).is(":visible")&&n.focus(),i.mouseDownOnSelect=!1}),m=e("<ul/>").appendTo(d).mouseover(function(t){o(t).nodeName&&"LI"==o(t).nodeName.toUpperCase()&&(v=e("li",m).removeClass(p.ACTIVE).index(o(t)),e(o(t)).addClass(p.ACTIVE))}).click(function(i){return e(o(i)).addClass(p.ACTIVE),a(),t.inputFocus&&n.focus(),!1}).mousedown(function(){i.mouseDownOnSelect=!0}).mouseup(function(){i.mouseDownOnSelect=!1}),t.width>0&&d.css("width",t.width),C=!1)}function o(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function l(e){f.slice(v,v+1).removeClass(p.ACTIVE),s(e);var n=f.slice(v,v+1).addClass(p.ACTIVE);if(t.scroll){var a=0;f.slice(0,v).each(function(){a+=this.offsetHeight}),a+n[0].offsetHeight-m.scrollTop()>m[0].clientHeight?m.scrollTop(a+n[0].offsetHeight-m.innerHeight()):a<m.scrollTop()&&m.scrollTop(a)}}function s(e){(t.scrollJumpPosition||!t.scrollJumpPosition&&!(e<0&&0==v||e>0&&v==f.size()-1))&&((v+=e)<0?v=f.size()-1:v>=f.size()&&(v=0))}function u(e){return t.max&&t.max<e?t.max:e}function c(){m.empty();for(var n=u(h.length),a=0;a<n;a++)if(h[a])if("[Restaurants]"==h[a].data||"[Dishes]"==h[a].data){var i=h[a].data,r=e("<li/>").html(t.highlight(i,g)).addClass("ac_title").appendTo(m)[0];e.data(r,"ac_data",h[a])}else{if(!1===(i=t.formatItem(h[a].data,a+1,n,h[a].value,g)))continue;r=e("<li/>").html(t.highlight(i,g)).addClass(a%2==0?"ac_even":"ac_odd").appendTo(m)[0];e.data(r,"ac_data",h[a])}f=m.find("li"),t.selectFirst&&(f.slice(0,1).addClass(p.ACTIVE),v=0),e.fn.bgiframe&&m.bgiframe()}var f,h,d,m,p={ACTIVE:"ac_over"},v=-1,g="",C=!0;return{display:function(e,t){r(),h=e,g=t,c()},next:function(){l(1)},prev:function(){l(-1)},pageUp:function(){l(0!=v&&v-8<0?-v:-8)},pageDown:function(){l(v!=f.size()-1&&v+8>f.size()?f.size()-1-v:8)},hide:function(){d&&d.hide(),f&&f.removeClass(p.ACTIVE),v=-1},visible:function(){return d&&d.is(":visible")},current:function(){return this.visible()&&(f.filter("."+p.ACTIVE)[0]||t.selectFirst&&f[0])},show:function(){var a=e(n).offset();if(d.css({width:"string"==typeof t.width||t.width>0?t.width:e(n).width(),top:a.top+n.offsetHeight,left:a.left}).show(),t.scroll&&(m.scrollTop(0),m.css({maxHeight:t.scrollHeight,overflow:"auto"}),-1!=navigator.userAgent.indexOf("MSIE")&&void 0===document.body.style.maxHeight)){var i=0;f.each(function(){i+=this.offsetHeight});var r=i>t.scrollHeight;m.css("height",r?t.scrollHeight:i),r||f.width(m.width()-parseInt(f.css("padding-left"))-parseInt(f.css("padding-right")))}},selected:function(){var t=f&&f.filter("."+p.ACTIVE).removeClass(p.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},emptyList:function(){m&&m.empty()},unbind:function(){d&&d.remove()}}},e.fn.selection=function(e,t){if(void 0!==e)return this.each(function(){if(this.createTextRange){var n=this.createTextRange();void 0===t||e==t?(n.move("character",e),n.select()):(n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select())}else this.setSelectionRange?this.setSelectionRange(e,t):this.selectionStart&&(this.selectionStart=e,this.selectionEnd=t)});var n=this[0];if(n.createTextRange){var a=document.selection.createRange(),i=n.value,r=a.text.length;a.text="<->";var o=n.value.indexOf("<->");return n.value=i,this.selection(o,o+r),{start:o,end:o+r}}return void 0!==n.selectionStart?{start:n.selectionStart,end:n.selectionEnd}:void 0}}(jQuery);